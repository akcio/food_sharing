(this.webpackJsonpfood_sharing=this.webpackJsonpfood_sharing||[]).push([[0],{151:function(e,t,n){e.exports=n(238)},238:function(e,t,n){"use strict";n.r(t);n(152),n(178),n(180),n(181),n(183),n(184),n(185),n(186),n(187),n(188),n(189),n(190),n(192),n(193),n(194),n(195),n(196),n(197),n(198),n(199),n(200),n(201),n(203),n(204),n(205),n(206),n(207),n(208),n(209),n(210),n(211),n(212),n(213),n(214),n(215),n(216),n(217),n(218),n(219),n(220);var a=n(0),i=n.n(a),r=n(33),c=n.n(r),s=n(21),o=n.n(s),l=n(34),u=n.n(l),h=n(28),p=n(29),d=n(36),m=n(35),f=n(47),b=n(37),g=n(11),y=(n(237),n(93)),v=n.n(y),j=function(e){function t(e){return Object(h.a)(this,t),Object(d.a)(this,Object(m.a)(t).call(this,e))}return Object(b.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){var e=this.props,t=e.id,n=e.items;return i.a.createElement(g.e,{id:t},i.a.createElement(g.f,null,"\u0422\u043e\u0432\u0430\u0440\u044b"),i.a.createElement(g.c,null,i.a.createElement(g.d,null,n.length>0&&n.map((function(e,t){return i.a.createElement(g.a,{key:t,before:i.a.createElement("img",{style:{width:40,height:40,margin:10},src:e.thumb_photo}),multiline:!0,description:e.description},e.title,", ",e.price.amount," ",e.price.currency.name)})),0==n.length&&i.a.createElement(g.b,null,"\u0425\u043c, \u043d\u043e \u043c\u044b \u043d\u0435 \u043d\u0430\u0448\u043b\u0438 \u0442\u043e\u0432\u0430\u0440\u043e\u0432."))))}}]),t}(i.a.Component),k=new(function(){function e(){Object(h.a)(this,e),this.apiURL="https://ileaban.space/api/v1"}return Object(p.a)(e,[{key:"shareItem",value:function(e,t,n,a,i,r,c,s){return u.a.async((function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",fetch(this.apiURL+"share/",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({user_id:e,caption:t,description:n,image_url:c,lat:a,lon:i,price:r,expiration:s})}).then((function(e){return e.json()})));case 1:case"end":return o.stop()}}),null,this)}},{key:"getNearby",value:function(e,t){return u.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",fetch(this.apiURL+"nearby/",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({lat:e,lon:t})}).then((function(e){return e.json()})));case 1:case"end":return n.stop()}}),null,this)}},{key:"deleteMyItem",value:function(e,t){return u.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",fetch(this.apiURL+"delete/",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({share_id:e,vk_id:t})}).then((function(e){return e.json()})));case 1:case"end":return n.stop()}}),null,this)}}]),e}()),O=function(e){function t(e){return Object(h.a)(this,t),Object(d.a)(this,Object(m.a)(t).call(this,e))}return Object(b.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){var e=this.props,t=e.id,n=e.items;return i.a.createElement(g.e,{id:t},i.a.createElement(g.f,null,"\u041f\u043e\u0431\u043b\u0438\u0437\u043e\u0441\u0442\u0438, \u0433\u043e\u0442\u043e\u0432\u044b \u043f\u043e\u0434\u0435\u043b\u0438\u0442\u044c\u0441\u044f:"),i.a.createElement(g.c,null,i.a.createElement(g.d,null,n.length>0&&n.map((function(e,t){return i.a.createElement(g.a,{key:t,before:i.a.createElement("img",{style:{width:40,height:40,margin:10},src:e.image_url}),multiline:!0,description:e.description},e.caption,", ",e.price,", \u0420\u0430\u0441\u0442\u043e\u044f\u043d\u0438\u0435: ",e.distance,"\u043c")})),0==n.length&&i.a.createElement(g.b,null,"\u0425\u043c, \u0441\u0435\u0433\u043e\u0434\u043d\u044f \u0432\u0441\u0435 \u0436\u0430\u0434\u043d\u044b\u0435..."))))}}]),t}(i.a.Component),E=function(e){function t(e){var n;return Object(h.a)(this,t),(n=Object(d.a)(this,Object(m.a)(t).call(this,e))).go=function(e){n.setState({activePanel:e.currentTarget.dataset.to})},n.state={activePanel:"home",fetchedUser:null,authToken:null,items:[],sharing:[]},n.getItems=n.getItems.bind(Object(f.a)(n)),n}return Object(b.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){var e=this;o.a.subscribe((function(t){switch(t.detail.type){case"VKWebAppGetUserInfoResult":e.setState({fetchedUser:t.detail.data});break;case"VKWebAppAccessTokenReceived":e.setState({authToken:t.detail.data.access_token}),o.a.send("VKWebAppGetGeodata",{});break;case"VKWebAppGeodataResult":t.detail.data.available?e.getSharedItems((t.detail.data.lat,t.detail.data.long)):console.log("Geo declined");break;default:console.log(t.detail.type)}})),o.a.send("VKWebAppGetUserInfo",{}),o.a.send("VKWebAppGetAuthToken",{app_id:7234568,scope:"photos, friends"})}},{key:"getItems",value:function(){var e=this,t="https://api.vk.com/method/market.get?v=5.52&access_token=".concat(this.state.authToken,"&owner_id=-").concat(124527492);v()(t).then((function(e){return e.json()})).then((function(t){return e.setState({items:t.response.items})})).catch((function(e){return[]}))}},{key:"getSharedItems",value:function(e,t){var n;return u.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,u.a.awrap(k.getNearby(e,t));case 2:n=a.sent,console.log("----------------"),console.log(n),this.setState({activePanel:"shared_items",sharing:n.data}),console.log(this.sharing);case 7:case"end":return a.stop()}}),null,this)}},{key:"render",value:function(){return i.a.createElement(g.g,{activePanel:this.state.activePanel},i.a.createElement(j,{id:"home",items:this.state.items,fetchedUser:this.state.fetchedUser,go:this.go}),i.a.createElement(O,{id:"shared_items",items:this.state.sharing}))}}]),t}(i.a.Component);o.a.send("VKWebAppInit"),c.a.render(i.a.createElement(E,null),document.getElementById("root"))}},[[151,1,2]]]);
//# sourceMappingURL=main.967ed293.chunk.js.map